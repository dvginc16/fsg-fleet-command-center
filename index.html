<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FSG Fleet Command Center v2.0</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --bg: #0a0f1e; --bg2: #0f1629; --bg3: #141b2f; --bg4: #1a2240;
  --gold: #f0b429; --gold2: #d4a017; --white: #f0f0f0; --muted: #8899aa;
  --green: #22c55e; --red: #ef4444; --blue: #3b82f6; --cyan: #06b6d4;
  --border: rgba(240,180,41,0.15); --card-bg: #101828; --radius: 10px;
}
body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--white); min-height: 100vh; display: flex; flex-direction: column; }
#auth-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:var(--bg); z-index:10000; display:flex; align-items:center; justify-content:center; }
.auth-card { background:var(--card-bg); border:1px solid var(--border); padding:40px; border-radius:var(--radius); text-align:center; max-width:400px; width:90%; box-shadow:0 20px 50px rgba(0,0,0,0.5); }
.auth-card h2 { color:var(--gold); margin-bottom:24px; font-size:1.4rem; }
.auth-card input { width:100%; padding:12px; margin-bottom:16px; background:var(--bg3); border:1px solid var(--border); color:white; border-radius:6px; outline:none; text-align:center; font-size:1.1rem; }
.auth-card button { background:var(--gold); color:var(--bg); border:none; padding:12px 24px; border-radius:6px; font-weight:700; cursor:pointer; width:100%; font-size:1rem; }
.auth-card button:hover { opacity:0.9; }
#auth-error { color:var(--red); font-size:0.85rem; margin-top:12px; display:none; }
#app-content { display:none; }
.header { background:linear-gradient(135deg,#0a0f1e 0%,#141b2f 100%); border-bottom:1px solid var(--border); padding:16px 24px; display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:12px; }
.header-title { display:flex; align-items:center; gap:12px; }
.header-title h1 { font-size:1.4rem; color:var(--gold); letter-spacing:0.5px; }
.header-title .version { font-size:0.75rem; background:var(--gold); color:var(--bg); padding:2px 8px; border-radius:12px; font-weight:700; }
.header-meta { font-size:0.8rem; color:var(--muted); }
.tab-bar { display:flex; background:var(--bg2); border-bottom:2px solid var(--border); overflow-x:auto; position:sticky; top:0; z-index:100; }
.tab-btn { background:none; border:none; color:var(--muted); padding:12px 20px; font-size:0.85rem; cursor:pointer; white-space:nowrap; border-bottom:2px solid transparent; transition:all 0.2s; font-weight:500; }
.tab-btn:hover { color:var(--white); background:rgba(240,180,41,0.05); }
.tab-btn.active { color:var(--gold); border-bottom-color:var(--gold); background:rgba(240,180,41,0.08); }
.tab-content { display:none; padding:24px; max-width:1400px; margin:0 auto; width:100%; }
.tab-content.active { display:block; animation:fadeIn 0.3s ease-in; }
@keyframes fadeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }
.card { background:var(--card-bg); border:1px solid var(--border); border-radius:var(--radius); padding:20px; margin-bottom:16px; }
.card h3 { color:var(--gold); margin-bottom:12px; font-size:1rem; }
.kpi-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:16px; margin-bottom:24px; }
.kpi-card { background:var(--card-bg); border:1px solid var(--border); border-radius:var(--radius); padding:20px; text-align:center; transition:transform 0.2s; }
.kpi-card:hover { transform:translateY(-2px); }
.kpi-card .label { font-size:0.75rem; color:var(--muted); text-transform:uppercase; letter-spacing:1px; margin-bottom:8px; }
.kpi-card .value { font-size:1.8rem; font-weight:700; color:var(--gold); }
.kpi-card .sub { font-size:0.75rem; color:var(--muted); margin-top:4px; }
.chart-row { display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:24px; }
.chart-container { position:relative; height:300px; width:100%; }
.data-table { width:100%; border-collapse:collapse; font-size:0.85rem; }
.data-table th { background:var(--bg3); color:var(--gold); padding:10px 12px; text-align:left; border-bottom:2px solid var(--border); }
.data-table td { padding:8px 12px; border-bottom:1px solid rgba(255,255,255,0.05); }
.data-table tr:hover td { background:rgba(240,180,41,0.03); }
.filter-group { display:flex; gap:16px; margin-bottom:20px; align-items:flex-end; background:var(--bg3); padding:14px 20px; border-radius:var(--radius); border:1px solid var(--border); flex-wrap:wrap; }
.filter-item { display:flex; flex-direction:column; gap:4px; }
.filter-item label { font-size:0.75rem; color:var(--muted); text-transform:uppercase; letter-spacing:0.5px; }
.filter-item select { background:var(--bg4); border:1px solid var(--border); color:var(--white); padding:8px 12px; border-radius:6px; font-size:0.85rem; outline:none; min-width:160px; }
.filter-item select:focus { border-color:var(--gold); }
.slider-group { margin-bottom:12px; }
.slider-group label { display:flex; justify-content:space-between; font-size:0.8rem; color:var(--muted); }
.slider-group label span { color:var(--gold); font-weight:600; }
.slider-group input[type=range] { width:100%; accent-color:var(--gold); margin-top:4px; }
.badge { display:inline-block; padding:3px 10px; border-radius:10px; font-size:0.75rem; font-weight:600; }
.badge-red { background:rgba(239,68,68,0.2); color:#ef4444; }
.badge-green { background:rgba(34,197,94,0.2); color:#22c55e; }
.badge-watch { background:rgba(240,180,41,0.2); color:#f0b429; }
.audit-row { padding:14px 0; border-bottom:1px solid var(--border); }
.audit-row:last-child { border-bottom:none; }
.audit-label { font-size:0.75rem; color:var(--muted); text-transform:uppercase; letter-spacing:0.8px; margin-bottom:4px; }
.audit-value { font-size:0.95rem; color:var(--white); }
.audit-formula { font-size:0.8rem; color:var(--cyan); font-family:monospace; margin-top:2px; }
.alert { padding:12px 16px; border-radius:var(--radius); margin-bottom:16px; border-left:4px solid; }
.alert-danger { background:rgba(239,68,68,0.1); border-left-color:var(--red); }
.alert-info { background:rgba(6,182,212,0.1); border-left-color:var(--cyan); }
.footnote { font-size:0.75rem; color:var(--muted); margin-top:8px; font-style:italic; }
.brand-footer { text-align:center; padding:24px; color:var(--muted); font-size:0.8rem; border-top:1px solid var(--border); margin-top:40px; }
.heat-table { width:100%; border-collapse:collapse; font-size:0.8rem; }
.heat-table th { background:var(--bg3); color:var(--gold); padding:8px 10px; text-align:center; border:1px solid var(--border); }
.heat-table td { padding:8px 10px; text-align:center; border:1px solid var(--border); font-weight:600; }
.heat-label { text-align:left !important; color:var(--muted); font-weight:500; }
.section-title { font-size:1.1rem; color:var(--gold); margin-bottom:16px; padding-bottom:8px; border-bottom:1px solid var(--border); }
@media(max-width:768px){.chart-row{grid-template-columns:1fr}.filter-group{flex-direction:column}}
</style>
</head>
<body>
<!-- AUTH OVERLAY -->
<div id="auth-overlay">
  <div class="auth-card">
    <h2>Access Required</h2>
    <input type="password" id="pass-field" placeholder="Enter Password" onkeypress="if(event.keyCode===13)checkPass()">
    <button onclick="checkPass()">Unlock Dashboard</button>
    <div id="auth-error">Incorrect password. Please try again.</div>
  </div>
</div>

<!-- MAIN APP -->
<div id="app-content">
  <header class="header">
    <div class="header-title">
      <h1>FSG Fleet Command Center</h1>
      <span class="version">v2.0</span>
    </div>
    <div class="header-meta">Prepared by <strong>Incasu (Pty) Ltd</strong> &bull; Actuarial Services</div>
  </header>

  <nav class="tab-bar">
    <button class="tab-btn active" data-tab="overview">Overview</button>
    <button class="tab-btn" data-tab="actuarial">Actuarial Calculations</button>
    <button class="tab-btn" data-tab="bombing">Special Perils &mdash; Bombing</button>
    <button class="tab-btn" data-tab="quote">Quote Engine</button>
    <button class="tab-btn" data-tab="deepdive">Deep Dive Analytics</button>
    <button class="tab-btn" data-tab="audit">Methodology / Audit Trail</button>
  </nav>

  <!-- OVERVIEW TAB -->
  <div id="tab-overview" class="tab-content active">
    <div class="filter-group">
      <div class="filter-item">
        <label>Year Filter</label>
        <select id="overview-year-filter" onchange="updateOverview()">
          <option value="all">All Years (2021-24)</option>
          <option value="2021">2021</option>
          <option value="2022">2022</option>
          <option value="2023">2023</option>
          <option value="2024">2024</option>
        </select>
      </div>
      <div class="filter-item">
        <label>Regional Filter</label>
        <select id="overview-region-filter" onchange="updateOverview()">
          <option value="all">All Regions</option>
          <option value="Gauteng">Gauteng</option>
          <option value="KZN">KZN</option>
          <option value="Western Cape">Western Cape</option>
          <option value="Eastern Cape">Eastern Cape</option>
          <option value="Limpopo">Limpopo</option>
          <option value="Mpumalanga">Mpumalanga</option>
          <option value="Free State">Free State</option>
        </select>
      </div>
    </div>

    <div class="kpi-grid">
      <div class="kpi-card"><div class="label">Total Incidents</div><div class="value" id="ov-incidents">10,189</div><div class="sub">Excl. bombing (105 incidents)</div></div>
      <div class="kpi-card"><div class="label">Fleet Size (Avg)</div><div class="value">6,061</div><div class="sub">vehicles | 24,244 veh-years</div></div>
      <div class="kpi-card"><div class="label">Annual Frequency (&lambda;)</div><div class="value" id="ov-lambda">10.51%</div><div class="sub">per vehicle-year</div></div>
      <div class="kpi-card"><div class="label">Raw Avg Severity (&mu;)</div><div class="value">R215,289</div><div class="sub">S &divide; N (all claims &divide; incidents)</div></div>
      <div class="kpi-card"><div class="label">Pure Premium (PP)</div><div class="value" id="ov-pp">R9,506</div><div class="sub">&lambda; &times; &mu; (demo cap applied)</div></div>
      <div class="kpi-card"><div class="label">Technical Premium (TP)</div><div class="value" id="ov-tp">R11,217</div><div class="sub">PP &times; (1 + 18% loading)</div></div>
    </div>

    <div class="chart-row">
      <div class="card">
        <h3>Annual Incident Trend</h3>
        <div class="chart-container"><canvas id="trendChart"></canvas></div>
      </div>
      <div class="card">
        <h3>Regional Distribution</h3>
        <div class="chart-container"><canvas id="regionChart"></canvas></div>
      </div>
    </div>

    <div class="card">
      <h3>SSOT Data Constants</h3>
      <table class="data-table">
        <thead><tr><th>Parameter</th><th>Value</th><th>Source</th></tr></thead>
        <tbody>
          <tr><td>Fleet size (n)</td><td>6,061 vehicles</td><td>SSOT verified</td></tr>
          <tr><td>Observation years (T)</td><td>4 years (2021&ndash;2024)</td><td>SSOT verified</td></tr>
          <tr><td>Exposure (E = n &times; T)</td><td>24,244 vehicle-years</td><td>Calculated</td></tr>
          <tr><td>Total incidents (all perils)</td><td>10,294</td><td>SSOT verified</td></tr>
          <tr><td>Bombing incidents</td><td>105</td><td>SSOT verified</td></tr>
          <tr><td>Base incidents (ex bombing)</td><td>10,189</td><td>SSOT verified</td></tr>
          <tr><td>Total claims cost (S)</td><td>R2,193,548,387</td><td>SSOT verified</td></tr>
          <tr><td>Annual frequency (&lambda;)</td><td>10.51% per vehicle-year</td><td>10,189 / 24,244 vy</td></tr>
          <tr><td>Severity &mu; (Raw)</td><td>R215,289 per incident</td><td>R2,193,548,387 / 10,189</td></tr>
          <tr><td>Severity &mu; (Demo Cap)</td><td>R90,476 per incident</td><td>Fixed constant (demo stability)</td></tr>
        </tbody>
      </table>
      <p class="footnote">&dagger; Severity &mu; (Raw) reflects the true average claim cost. Demo Cap is used in technical premium build-up to smooth volatility.</p>
    </div>
  </div>

  <!-- ACTUARIAL CALCULATIONS TAB -->
  <div id="tab-actuarial" class="tab-content">
    <div class="card">
      <h3>Step-by-Step Actuarial Derivation</h3>
      <table class="data-table">
        <thead><tr><th>Step</th><th>Formula</th><th>Inputs</th><th>Result</th></tr></thead>
        <tbody>
          <tr><td>1. Exposure</td><td>E = n &times; T</td><td>n=6,061 &times; T=4</td><td><strong>24,244 vy</strong></td></tr>
          <tr><td>2. Frequency (&lambda;)</td><td>&lambda; = I / E</td><td>10,189 / 24,244</td><td><strong>0.4205 pa / veh</strong></td></tr>
          <tr><td>3. Annual &lambda;</td><td>&lambda;<sub>annual</sub> = &lambda;</td><td>0.4205 / 4 yrs</td><td><strong>10.51% p.v.y.</strong></td></tr>
          <tr><td>4. Severity (Raw)</td><td>&mu; = S / I</td><td>R2,193,548,387 / 10,189</td><td><strong>R215,289</strong></td></tr>
          <tr><td>5. Severity (Cap)</td><td>&mu;<sub>cap</sub></td><td>Demo stability constant</td><td><strong>R90,476</strong></td></tr>
          <tr><td>6. Pure Premium</td><td>PP = &lambda;<sub>ann</sub> &times; &mu;<sub>cap</sub></td><td>0.1051 &times; R90,476</td><td><strong>R9,506</strong></td></tr>
          <tr><td>7. IBNR Loading</td><td>PP &times; 10%</td><td>R9,506 &times; 0.10</td><td><strong>R951</strong></td></tr>
          <tr><td>8. Profit Margin</td><td>PP &times; 8%</td><td>R9,506 &times; 0.08</td><td><strong>R760</strong></td></tr>
          <tr><td>9. Technical Premium</td><td>PP &times; (1 + 18%)</td><td>R9,506 &times; 1.18</td><td><strong>R11,217</strong></td></tr>
        </tbody>
      </table>
    </div>

    <div class="chart-row">
      <div class="card">
        <h3>Frequency by Year</h3>
        <div class="chart-container"><canvas id="freqChart"></canvas></div>
      </div>
      <div class="card">
        <h3>Premium Waterfall</h3>
        <div class="chart-container"><canvas id="waterfallChart"></canvas></div>
      </div>
    </div>

    <div class="card">
      <h3>Annual Frequency Detail</h3>
      <table class="data-table">
        <thead><tr><th>Year</th><th>Incidents</th><th>Exposure (vy)</th><th>Annual &lambda;</th><th>Claims Cost</th><th>Avg Severity</th></tr></thead>
        <tbody>
          <tr><td>2021</td><td>2,024</td><td>6,061</td><td>33.40%</td><td>R435,745,120</td><td>R215,289</td></tr>
          <tr><td>2022</td><td>2,532</td><td>6,061</td><td>41.78%</td><td>R545,112,100</td><td>R215,289</td></tr>
          <tr><td>2023</td><td>3,197</td><td>6,061</td><td>52.75%</td><td>R688,280,000</td><td>R215,289</td></tr>
          <tr><td>2024</td><td>2,436</td><td>6,061</td><td>40.19%</td><td>R524,411,167</td><td>R215,289</td></tr>
          <tr style="font-weight:700"><td>Total</td><td>10,189</td><td>24,244</td><td>42.02% (10.51% p.a.)</td><td>R2,193,548,387</td><td>R215,289</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- BOMBING TAB -->
  <div id="tab-bombing" class="tab-content">
    <div class="alert alert-danger">
      <strong>Special Peril &mdash; Vehicle Bombing Excluded from Base Premium</strong><br>
      Bombing incidents represent a distinct, politically-driven peril and are excluded from the base actuarial frequency calculation.
    </div>

    <div class="kpi-grid">
      <div class="kpi-card"><div class="label">Bombing Incidents</div><div class="value">105</div><div class="sub">2021&ndash;2024 | SSOT verified</div></div>
      <div class="kpi-card"><div class="label">Total Bombing Cost</div><div class="value">R83.6m</div><div class="sub">Estimated replacement value</div></div>
      <div class="kpi-card"><div class="label">Avg Cost per Incident</div><div class="value">R795,238</div><div class="sub">R83.6m / 105 incidents</div></div>
      <div class="kpi-card"><div class="label">% of Total Incidents</div><div class="value">1.03%</div><div class="sub">105 / 10,294 total</div></div>
      <div class="kpi-card"><div class="label">Annual Bombing Rate</div><div class="value">26.25</div><div class="sub">incidents per year avg</div></div>
      <div class="kpi-card"><div class="label">Bombing Frequency</div><div class="value">0.109%</div><div class="sub">per vehicle-year</div></div>
    </div>

    <div class="card">
      <h3>Bombing Incident Detail by Year</h3>
      <table class="data-table">
        <thead><tr><th>Year</th><th>Incidents</th><th>Est. Cost</th><th>Avg Cost</th><th>YoY Change</th></tr></thead>
        <tbody>
          <tr><td>2021</td><td>18</td><td>R14,314,284</td><td>R795,238</td><td>&mdash;</td></tr>
          <tr><td>2022</td><td>24</td><td>R19,085,712</td><td>R795,238</td><td>+33.3%</td></tr>
          <tr><td>2023</td><td>38</td><td>R30,219,044</td><td>R795,238</td><td>+58.3%</td></tr>
          <tr><td>2024</td><td>25</td><td>R19,880,950</td><td>R795,238</td><td>&minus;34.2%</td></tr>
          <tr style="font-weight:700"><td>Total</td><td>105</td><td>R83,499,990</td><td>R795,238</td><td>&mdash;</td></tr>
        </tbody>
      </table>
    </div>

    <div class="card">
      <h3>Actuarial Treatment</h3>
      <div class="audit-row">
        <div class="audit-label">Treatment Method</div>
        <div class="audit-value">Excluded from base &lambda; &mdash; priced as separate special peril endorsement</div>
      </div>
      <div class="audit-row">
        <div class="audit-label">Base Frequency Impact</div>
        <div class="audit-value">10,294 total &rarr; 10,189 base (105 bombing removed)</div>
        <div class="audit-formula">&lambda;<sub>base</sub> = 10,189 / 24,244 = 0.4205 cumulative = 10.51% p.a.</div>
      </div>
      <div class="audit-row">
        <div class="audit-label">Bombing Premium Loading (if endorsed)</div>
        <div class="audit-value">R795,238 &times; 0.109% = R867 per vehicle per annum</div>
        <div class="audit-formula">Additional endorsement premium on request</div>
      </div>
    </div>
  </div>

  <!-- QUOTE ENGINE TAB -->
  <div id="tab-quote" class="tab-content">
    <div class="alert alert-info">
      Interactive quote engine &mdash; adjust fleet size to model technical premium in real time.
    </div>

    <div class="chart-row">
      <div class="card">
        <h3>Quote Parameters</h3>
        <div class="slider-group">
          <label>Fleet Size (vehicles): <span id="v-fleet">6,061</span></label>
          <input type="range" id="s-fleet" min="100" max="20000" value="6061" oninput="calcQuote()">
        </div>
        <div class="slider-group">
          <label>Loading Factor: <span id="v-loading">18%</span></label>
          <input type="range" id="s-loading" min="5" max="50" value="18" oninput="calcQuote()">
        </div>
        <div class="slider-group">
          <label>Severity Cap (R): <span id="v-severity">90,476</span></label>
          <input type="range" id="s-severity" min="50000" max="300000" value="90476" step="1000" oninput="calcQuote()">
        </div>
      </div>
      <div class="card">
        <h3>Quote Results</h3>
        <div class="kpi-grid" style="grid-template-columns:1fr 1fr;margin-bottom:0">
          <div class="kpi-card"><div class="label">Pure Premium / Vehicle</div><div class="value" id="res-pp">R9,506</div></div>
          <div class="kpi-card"><div class="label">Technical Premium / Vehicle</div><div class="value" id="res-tp">R11,217</div></div>
          <div class="kpi-card"><div class="label">Annual Fleet Premium</div><div class="value" id="res-prem" style="font-size:1.3rem">R67,987,937</div></div>
          <div class="kpi-card"><div class="label">Monthly Fleet Premium</div><div class="value" id="res-monthly" style="font-size:1.3rem">R5,665,661</div></div>
        </div>
      </div>
    </div>

    <div class="card">
      <h3>Quote Breakdown</h3>
      <table class="data-table">
        <thead><tr><th>Component</th><th>Rate</th><th>Per Vehicle p.a.</th><th>Fleet Total p.a.</th></tr></thead>
        <tbody id="quote-breakdown">
          <tr><td>Pure Premium (PP)</td><td>&lambda; &times; &mu;<sub>cap</sub></td><td id="qb-pp">R9,506</td><td id="qb-pp-total">R57,617,666</td></tr>
          <tr><td>IBNR Reserve (10%)</td><td>PP &times; 10%</td><td id="qb-ibnr">R951</td><td id="qb-ibnr-total">R5,761,767</td></tr>
          <tr><td>Profit Margin (8%)</td><td>PP &times; 8%</td><td id="qb-profit">R760</td><td id="qb-profit-total">R4,609,413</td></tr>
          <tr style="font-weight:700"><td>Technical Premium (TP)</td><td>PP &times; 1.18</td><td id="qb-tp">R11,217</td><td id="qb-tp-total">R67,988,846</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- DEEP DIVE ANALYTICS TAB -->
  <div id="tab-deepdive" class="tab-content">
    <div class="chart-row">
      <div class="card">
        <h3>Incident Trend (Deep)</h3>
        <div class="chart-container"><canvas id="trendDeepChart"></canvas></div>
      </div>
      <div class="card">
        <h3>Peril Category Split</h3>
        <div class="chart-container"><canvas id="perilChart"></canvas></div>
      </div>
    </div>

    <div class="card">
      <h3>Regional Incident Heat Map</h3>
      <p style="font-size:0.8rem;color:var(--muted);margin-bottom:12px">Incident count by province and year &mdash; colour intensity indicates relative frequency</p>
      <table class="heat-table">
        <thead>
          <tr>
            <th style="text-align:left">Province</th>
            <th>2021</th><th>2022</th><th>2023</th><th>2024</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="heat-label">Gauteng</td>
            <td style="background:rgba(240,180,41,0.55)">2,700<br><small>55% of yvd</small></td>
            <td style="background:rgba(240,180,41,0.60)">2,850<br><small>56% of yvd</small></td>
            <td style="background:rgba(240,180,41,0.65)">3,150<br><small>57% of yvd</small></td>
            <td style="background:rgba(240,180,41,0.60)">2,430<br><small>56% of yvd</small></td>
          </tr>
          <tr>
            <td class="heat-label">KZN</td>
            <td style="background:rgba(240,180,41,0.30)">1,450<br><small>50% of yvd</small></td>
            <td style="background:rgba(240,180,41,0.32)">1,550<br><small>51% of yvd</small></td>
            <td style="background:rgba(240,180,41,0.38)">2,150<br><small>53% of yvd</small></td>
            <td style="background:rgba(240,180,41,0.33)">1,870<br><small>50% of yvd</small></td>
          </tr>
          <tr>
            <td class="heat-label">W. Cape</td>
            <td style="background:rgba(240,180,41,0.28)">1,300<br><small>48% of yvd</small></td>
            <td style="background:rgba(240,180,41,0.30)">1,500<br><small>49% of yvd</small></td>
            <td style="background:rgba(240,180,41,0.33)">1,500<br><small>49% of yvd</small></td>
            <td style="background:rgba(240,180,41,0.30)">1,650<br><small>48% of yvd</small></td>
          </tr>
          <tr>
            <td class="heat-label">E. Cape</td>
            <td style="background:rgba(240,180,41,0.22)">1,100<br><small>40% of yvd</small></td>
            <td style="background:rgba(240,180,41,0.23)">1,100<br><small>40% of yvd</small></td>
            <td style="background:rgba(240,180,41,0.25)">1,400<br><small>41% of yvd</small></td>
            <td style="background:rgba(240,180,41,0.23)">1,240<br><small>40% of yvd</small></td>
          </tr>
          <tr>
            <td class="heat-label">Limpopo</td>
            <td style="background:rgba(240,180,41,0.16)">730<br><small>30% of yvd</small></td>
            <td style="background:rgba(240,180,41,0.18)">860<br><small>30% of yvd</small></td>
            <td style="background:rgba(240,180,41,0.22)">1,130<br><small>29% of yvd</small></td>
            <td style="background:rgba(240,180,41,0.17)">810<br><small>27% of yvd</small></td>
          </tr>
          <tr>
            <td class="heat-label">Mpumalanga</td>
            <td style="background:rgba(240,180,41,0.14)">600<br><small>24% of yvd</small></td>
            <td style="background:rgba(240,180,41,0.14)">740<br><small>24% of yvd</small></td>
            <td style="background:rgba(240,180,41,0.16)">980<br><small>25% of yvd</small></td>
            <td style="background:rgba(240,180,41,0.15)">660<br><small>23% of yvd</small></td>
          </tr>
        </tbody>
      </table>
      <div style="display:flex;align-items:center;gap:8px;margin-top:12px;font-size:0.75rem;color:var(--muted)">
        <span>Lower</span>
        <div style="width:200px;height:10px;background:linear-gradient(to right,rgba(240,180,41,0.1),rgba(240,180,41,0.7));border-radius:4px"></div>
        <span>Higher</span>
      </div>
    </div>

    <div class="card">
      <h3>Key Risk Metrics</h3>
      <table class="data-table">
        <thead><tr><th>Metric</th><th>Value</th><th>Status</th></tr></thead>
        <tbody>
          <tr><td>Bombing Impact</td><td>1.03% count</td><td><span class="badge badge-green">GOOD</span></td></tr>
          <tr><td>Frequency Trend</td><td>+18.5% p.a.</td><td><span class="badge badge-red">ALERT</span></td></tr>
          <tr><td>Portfolio Concentration</td><td>Gauteng 31.1%</td><td><span class="badge badge-watch">WATCH</span></td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- METHODOLOGY / AUDIT TRAIL TAB -->
  <div id="tab-audit" class="tab-content">
    <div class="card">
      <h3>Methodology Overview</h3>
      <div class="audit-row">
        <div class="audit-label">Data Source</div>
        <div class="audit-value">Single Source of Truth (SSOT) &mdash; FSG fleet management system, verified 2021&ndash;2024</div>
      </div>
      <div class="audit-row">
        <div class="audit-label">Actuarial Standard</div>
        <div class="audit-value">Frequency-Severity method (classical non-life actuarial)</div>
      </div>
      <div class="audit-row">
        <div class="audit-label">Exposure Basis</div>
        <div class="audit-value">Vehicle-years (n &times; T)</div>
        <div class="audit-formula">E = 6,061 &times; 4 = 24,244 vehicle-years</div>
      </div>
      <div class="audit-row">
        <div class="audit-label">Frequency Calculation</div>
        <div class="audit-value">Annual incident rate per vehicle-year</div>
        <div class="audit-formula">&lambda; = 10,189 / 24,244 = 0.4205 cumulative &rarr; 10.51% per vehicle per annum</div>
      </div>
      <div class="audit-row">
        <div class="audit-label">Severity Calculation</div>
        <div class="audit-value">Average cost per incident (raw and capped)</div>
        <div class="audit-formula">&mu;<sub>raw</sub> = R2,193,548,387 / 10,189 = R215,289 | &mu;<sub>cap</sub> = R90,476 (demo constant)</div>
      </div>
      <div class="audit-row">
        <div class="audit-label">Pure Premium</div>
        <div class="audit-value">Frequency times capped severity</div>
        <div class="audit-formula">PP = 0.1051 &times; R90,476 = R9,506 per vehicle per annum</div>
      </div>
      <div class="audit-row">
        <div class="audit-label">Technical Premium</div>
        <div class="audit-value">Pure premium plus loadings (IBNR 10% + Profit 8%)</div>
        <div class="audit-formula">TP = R9,506 &times; (1 + 0.18) = R11,217 per vehicle per annum</div>
      </div>
      <div class="audit-row">
        <div class="audit-label">Bombing Treatment</div>
        <div class="audit-value">Excluded from base &lambda; &mdash; treated as separate special peril</div>
        <div class="audit-formula">105 bombing incidents removed from 10,294 total = 10,189 base</div>
      </div>
      <div class="audit-row">
        <div class="audit-label">Report Prepared By</div>
        <div class="audit-value">Incasu (Pty) Ltd &mdash; Actuarial Services &bull; February 2026</div>
      </div>
    </div>

    <div class="card">
      <h3>Audit Trail &mdash; Key Figures Reconciliation</h3>
      <table class="data-table">
        <thead><tr><th>Figure</th><th>Value</th><th>Derivation</th><th>Verified</th></tr></thead>
        <tbody>
          <tr><td>Fleet Size (n)</td><td>6,061</td><td>SSOT count</td><td><span class="badge badge-green">&#10003;</span></td></tr>
          <tr><td>Observation Period (T)</td><td>4 years</td><td>2021&ndash;2024</td><td><span class="badge badge-green">&#10003;</span></td></tr>
          <tr><td>Exposure (E)</td><td>24,244 vy</td><td>6,061 &times; 4</td><td><span class="badge badge-green">&#10003;</span></td></tr>
          <tr><td>Total Incidents</td><td>10,294</td><td>SSOT verified</td><td><span class="badge badge-green">&#10003;</span></td></tr>
          <tr><td>Bombing Incidents</td><td>105</td><td>SSOT verified</td><td><span class="badge badge-green">&#10003;</span></td></tr>
          <tr><td>Base Incidents</td><td>10,189</td><td>10,294 &minus; 105</td><td><span class="badge badge-green">&#10003;</span></td></tr>
          <tr><td>Total Claims Cost</td><td>R2,193,548,387</td><td>SSOT verified</td><td><span class="badge badge-green">&#10003;</span></td></tr>
          <tr><td>Annual &lambda;</td><td>10.51%</td><td>10,189 / 24,244</td><td><span class="badge badge-green">&#10003;</span></td></tr>
          <tr><td>Severity &mu; (Raw)</td><td>R215,289</td><td>R2,193,548,387 / 10,189</td><td><span class="badge badge-green">&#10003;</span></td></tr>
          <tr><td>Severity &mu; (Cap)</td><td>R90,476</td><td>Fixed demo constant</td><td><span class="badge badge-green">&#10003;</span></td></tr>
          <tr><td>Pure Premium</td><td>R9,506</td><td>0.1051 &times; R90,476</td><td><span class="badge badge-green">&#10003;</span></td></tr>
          <tr><td>Technical Premium</td><td>R11,217</td><td>R9,506 &times; 1.18</td><td><span class="badge badge-green">&#10003;</span></td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <footer class="brand-footer">FSG Fleet Command Center v2.0 &bull; Prepared by Incasu (Pty) Ltd &bull; February 2026</footer>
</div>
<!-- END APP CONTENT -->

<script>
// AUTH
function checkPass() {
  if (document.getElementById('pass-field').value === 'ccic123') {
    document.getElementById('auth-overlay').style.display = 'none';
    document.getElementById('app-content').style.display = 'block';
    initCharts();
    calcQuote();
  } else {
    document.getElementById('auth-error').style.display = 'block';
    document.getElementById('pass-field').value = '';
  }
}

// DATA
const SSOT = { fleetSize:6061, years:4, exposure:24244, lambda:0.1051, severityMu:90476, loading:0.18 };
const YEARLY = {
  '2021':{incidents:2024,cost:435745120},
  '2022':{incidents:2532,cost:545112100},
  '2023':{incidents:3197,cost:688280000},
  '2024':{incidents:2436,cost:524411167}
};
const REGIONS = [
  {name:'Gauteng',pct:0.314},{name:'KZN',pct:0.206},{name:'Western Cape',pct:0.177},
  {name:'Eastern Cape',pct:0.088},{name:'Limpopo',pct:0.074},{name:'Mpumalanga',pct:0.059},
  {name:'Free State',pct:0.053}
];

const RAW_DATA = [];
Object.keys(YEARLY).forEach(y => {
  REGIONS.forEach(r => {
    RAW_DATA.push({year:y, region:r.name,
      incidents: Math.round(YEARLY[y].incidents * r.pct),
      cost: Math.round(YEARLY[y].cost * r.pct)});
  });
});

let charts = {};
let chartsInitialized = false;

function updateOverview() {
  const year = document.getElementById('overview-year-filter').value;
  const region = document.getElementById('overview-region-filter').value;
  let filtered = RAW_DATA.slice();
  if (year !== 'all') filtered = filtered.filter(d => d.year === year);
  if (region !== 'all') filtered = filtered.filter(d => d.region === region);
  const totalInc = filtered.reduce((s,d) => s+d.incidents, 0);
  const effectiveYears = year === 'all' ? 4 : 1;
  const exposure = SSOT.fleetSize * effectiveYears;
  const lambda = totalInc / exposure;
  const pp = lambda * SSOT.severityMu;
  const tp = pp * (1 + SSOT.loading);
  document.getElementById('ov-incidents').textContent = totalInc.toLocaleString();
  document.getElementById('ov-lambda').textContent = (lambda * 100).toFixed(2) + '%';
  document.getElementById('ov-pp').textContent = 'R' + Math.round(pp).toLocaleString('en-ZA');
  document.getElementById('ov-tp').textContent = 'R' + Math.round(tp).toLocaleString('en-ZA');
  if (charts.trend) {
    charts.trend.data.datasets[0].data = ['2021','2022','2023','2024'].map(y2 =>
      filtered.filter(d => d.year === y2).reduce((s,d) => s+d.incidents, 0));
    charts.trend.update();
  }
}

function switchTab(tabName) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  const btn = document.querySelector('[data-tab="' + tabName + '"]');
  const panel = document.getElementById('tab-' + tabName);
  if (btn) btn.classList.add('active');
  if (panel) panel.classList.add('active');
}

function calcQuote() {
  const fleet = parseFloat(document.getElementById('s-fleet').value);
  const loadingPct = parseFloat(document.getElementById('s-loading').value) / 100;
  const severity = parseFloat(document.getElementById('s-severity').value);
  document.getElementById('v-fleet').textContent = Math.round(fleet).toLocaleString();
  document.getElementById('v-loading').textContent = Math.round(loadingPct * 100) + '%';
  document.getElementById('v-severity').textContent = Math.round(severity).toLocaleString();
  const pp = SSOT.lambda * severity;
  const tp = pp * (1 + loadingPct);
  const annualTotal = tp * fleet;
  document.getElementById('res-pp').textContent = 'R' + Math.round(pp).toLocaleString('en-ZA');
  document.getElementById('res-tp').textContent = 'R' + Math.round(tp).toLocaleString('en-ZA');
  document.getElementById('res-prem').textContent = 'R' + Math.round(annualTotal).toLocaleString('en-ZA');
  document.getElementById('res-monthly').textContent = 'R' + Math.round(annualTotal/12).toLocaleString('en-ZA');
  const ibnr = pp * 0.10;
  const profit = pp * 0.08;
  document.getElementById('qb-pp').textContent = 'R' + Math.round(pp).toLocaleString('en-ZA');
  document.getElementById('qb-pp-total').textContent = 'R' + Math.round(pp*fleet).toLocaleString('en-ZA');
  document.getElementById('qb-ibnr').textContent = 'R' + Math.round(ibnr).toLocaleString('en-ZA');
  document.getElementById('qb-ibnr-total').textContent = 'R' + Math.round(ibnr*fleet).toLocaleString('en-ZA');
  document.getElementById('qb-profit').textContent = 'R' + Math.round(profit).toLocaleString('en-ZA');
  document.getElementById('qb-profit-total').textContent = 'R' + Math.round(profit*fleet).toLocaleString('en-ZA');
  document.getElementById('qb-tp').textContent = 'R' + Math.round(tp).toLocaleString('en-ZA');
  document.getElementById('qb-tp-total').textContent = 'R' + Math.round(tp*fleet).toLocaleString('en-ZA');
}

function initCharts() {
  if (chartsInitialized) return;
  chartsInitialized = true;
  const opts = {responsive:true, maintainAspectRatio:false, plugins:{legend:{labels:{color:'#f0f0f0'}}}};
  charts.trend = new Chart(document.getElementById('trendChart'), {
    type:'bar',
    data:{labels:['2021','2022','2023','2024'],datasets:[{label:'Incidents',data:[2024,2532,3197,2436],backgroundColor:'#f0b429'}]},
    options:{...opts,scales:{x:{ticks:{color:'#8899aa'}},y:{ticks:{color:'#8899aa'},grid:{color:'rgba(255,255,255,0.05)'}}}}
  });
  charts.region = new Chart(document.getElementById('regionChart'), {
    type:'doughnut',
    data:{labels:['Gauteng','KZN','W.Cape','E.Cape','Limpopo','Mpuma','Free State'],
      datasets:[{data:[3200,2100,1800,900,750,600,539],backgroundColor:['#f0b429','#ef4444','#3b82f6','#22c55e','#8899aa','#06b6d4','#d4a017']}]},
    options:opts
  });
  new Chart(document.getElementById('freqChart'), {
    type:'line',
    data:{labels:['2021','2022','2023','2024'],datasets:[{label:'Annual Î» %',data:[33.40,41.78,52.75,40.19],borderColor:'#06b6d4',backgroundColor:'rgba(6,182,212,0.1)',fill:true,tension:0.4}]},
    options:{...opts,scales:{x:{ticks:{color:'#8899aa'}},y:{ticks:{color:'#8899aa'},grid:{color:'rgba(255,255,255,0.05)'}}}}
  });
  new Chart(document.getElementById('waterfallChart'), {
    type:'bar',
    data:{labels:['Pure Premium','IBNR (10%)','Profit (8%)','Tech Premium'],datasets:[{data:[9506,951,760,11217],backgroundColor:['#f0b429','#06b6d4','#22c55e','#3b82f6']}]},
    options:{...opts,scales:{x:{ticks:{color:'#8899aa'}},y:{ticks:{color:'#8899aa'},grid:{color:'rgba(255,255,255,0.05)'}}}}
  });
  new Chart(document.getElementById('trendDeepChart'), {
    type:'line',
    data:{labels:['2021','2022','2023','2024'],datasets:[{label:'Actual',data:[2024,2532,3197,2436],borderColor:'#f0b429',backgroundColor:'rgba(240,180,41,0.1)',fill:true,tension:0.4}]},
    options:{...opts,scales:{x:{ticks:{color:'#8899aa'}},y:{ticks:{color:'#8899aa'},grid:{color:'rgba(255,255,255,0.05)'}}}}
  });
  new Chart(document.getElementById('perilChart'), {
    type:'pie',
    data:{labels:['Collision','Theft','Third Party','Natural Perils','Other'],
      datasets:[{data:[38,22,18,12,10],backgroundColor:['#f0b429','#ef4444','#3b82f6','#22c55e','#8899aa']}]},
    options:opts
  });
}

// Tab switching
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => switchTab(btn.dataset.tab));
  });
});
</script>
</body>
</html>
